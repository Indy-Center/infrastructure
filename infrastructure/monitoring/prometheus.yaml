apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: kube-prometheus-stack
  namespace: monitoring
spec:
  repo: https://prometheus-community.github.io/helm-charts
  chart: kube-prometheus-stack
  version: "69.2.0"
  targetNamespace: monitoring
  valuesContent: |-
    grafana:
      ingress:
        enabled: false
      envFromSecret: grafana-oauth
      grafana.ini:
        server:
          root_url: https://metrics.zid-internal.com
          protocol: http
        auth.github:
          enabled: true
          allow_sign_up: true
          scopes: read:org,user:email,repo
          auth_url: https://github.com/login/oauth/authorize
          token_url: https://github.com/login/oauth/access_token
          api_url: https://api.github.com/user
          allowed_organizations: indy-center
          allowed_teams: indy-center/devops-team
          client_id: ${GF_AUTH_GITHUB_CLIENT_ID}
          client_secret: ${GF_AUTH_GITHUB_CLIENT_SECRET}
          role_attribute_path: "Admin"
        users:
          auto_assign_org_role: Admin
          auto_assign_org: true
    prometheus:
      ingress:
        enabled: false
    alertmanager:
      ingress:
        enabled: false 